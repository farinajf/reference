<?xml version="1.0" encoding="UTF-8"?>
<sequence name="AmtegaGenericFaultSequence" statistics="enable" trace="enable" xmlns="http://ws.apache.org/ns/synapse">
    <log category="ERROR" level="custom">
        <property name="text" value="LOG-ERROR:"/>
        <property expression="$ctx:AmtegaMessageID" name="AmtegaMessageID"/>
        <property expression="$axis2:HTTP_SC" name="HTTP_SC"/>
        <property expression="$ctx:ERROR_CODE" name="ERROR_CODE"/>
        <property expression="$ctx:ERROR_MESSAGE" name="ERROR_MESSAGE"/>
        <property expression="$ctx:ERROR_DETAIL" name="ERROR_DETAIL"/>
        <property expression="$ctx:ERROR_EXCEPTION" name="ERROR_EXCEPTION"/>
    </log>
    <filter regex="true" source="$ctx:IsClientDoingSOAP11">
        <then>
            <makefault description="SOAP11" response="true" version="soap11">
                <code value="soap11Env:Server" xmlns:soap11Env="http://schemas.xmlsoap.org/soap/envelope/"/>
                <reason expression="$ctx:ERROR_CODE"/>
                <detail expression="$ctx:ERROR_MESSAGE"/>
            </makefault>
        </then>
        <else>
            <filter regex="true" source="$ctx:IsClientDoingREST">
                <then>
                    <makefault description="REST" response="true" version="pox">
                        <reason expression="$ctx:ERROR_CODE"/>
                        <detail expression="$ctx:ERROR_MESSAGE"/>
                    </makefault>
                </then>
                <else>
                    <makefault description="SOAP12" response="true" version="soap12">
                        <code value="soap12Env:VersionMismatch" xmlns:soap12Env="http://www.w3.org/2003/05/soap-envelope"/>
                        <reason expression="$ctx:ERROR_CODE"/>
                        <detail expression="$ctx:ERROR_MESSAGE"/>
                    </makefault>
                </else>
            </filter>
        </else>
    </filter>
    <header action="remove" name="To" scope="default"/>
    <property name="RESPONSE" scope="default" type="STRING" value="true"/>
    <filter description="Si existe $ctx:AmtegaMessageID se establece como HTTP Header" xpath="$ctx:AmtegaMessageID">
        <then>
            <property expression="$ctx:AmtegaMessageID" name="AmtegaMessageID" scope="transport" type="STRING"/>
        </then>
        <else/>
    </filter>
    <send/>
</sequence>
